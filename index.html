<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#0b1220" />
<title>AI Resume Search (Full Working Prototype)</title>

<!-- TensorFlow.js -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>

<!-- Universal Sentence Encoder -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder@1.3.3/dist/universal-sentence-encoder.min.js"></script>

<style>
  :root{
    --bg: #0b1220;
    --panel: rgba(255,255,255,0.08);
    --border: rgba(255,255,255,0.14);
    --text: #e9eefc;
    --muted: rgba(233,238,252,0.7);
    --chip: rgba(255,255,255,0.10);
    --chipBorder: rgba(255,255,255,0.18);
    --card: rgba(255,255,255,0.07);
    --shadow: 0 14px 40px rgba(0,0,0,0.35);
    --radius: 16px;
  }

  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    padding: 14px;
  }

  .app { max-width: 980px; margin: auto; }

  header {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px;
    margin-bottom: 14px;
    box-shadow: var(--shadow);
    backdrop-filter: blur(10px);
  }

  h1 { margin: 0; font-size: 20px; }
  .sub { font-size: 13px; color: var(--muted); margin-top: 4px; }

  .bar {
    margin-top: 12px;
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 10px;
  }

  input[type="text"] {
    font-size: 16px;
    padding: 12px;
    border-radius: 12px;
    background: rgba(255,255,255,0.1);
    color: var(--text);
    border: 1px solid var(--border);
  }

  button {
    background: rgba(255,255,255,0.12);
    color: var(--text);
    border: 1px solid var(--border);
    padding: 12px 14px;
    border-radius: 12px;
    cursor: pointer;
  }

  .statusRow {
    margin-top: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .dot {
    width: 10px; height: 10px; border-radius: 50%;
    background: #777;
  }
  .dot.ok { background: #4ade80; }
  .dot.warn { background: #facc15; }

  .chips {
    display: flex;
    gap: 8px;
    overflow-x: auto;
    margin-top: 12px;
  }
  .pill {
    border: 1px solid var(--chipBorder);
    background: var(--chip);
    padding: 8px 12px;
    border-radius: 999px;
    font-size: 13px;
    white-space: nowrap;
  }

  #activeFilter {
    margin: 12px 4px;
    font-size: 13px;
    color: rgba(233,238,252,0.9);
  }

  .results {
    display: grid;
    gap: 16px;
  }

  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 16px;
    box-shadow: var(--shadow);
  }

  .cardTop {
    display: flex;
    justify-content: space-between;
  }

  .badge {
    background: rgba(125,211,252,0.12);
    border: 1px solid rgba(125,211,252,0.35);
    padding: 6px 12px;
    border-radius: 999px;
    font-size: 13px;
    font-weight: bold;
  }

  .snippet {
    margin-top: 10px;
    font-size: 14px;
    line-height: 1.45;
  }

  mark {
    background: rgba(250, 204, 21, 0.35);
    border-radius: 4px;
    padding: 2px 4px;
  }

</style>
</head>

<body>
<div class="app">
  <header>
    <h1>AI Resume Search</h1>
    <p class="sub">Semantic matching + keyword boosting. Fully in-browser AI.</p>

    <div class="bar">
      <input id="searchBox" type="text" placeholder="Try: C++ embedded linux, Java microservices, 5G, ML..." disabled />
      <button id="clearBtn">Clear</button>
    </div>

    <div class="statusRow">
      <div id="dot" class="dot"></div>
      <div id="status" class="status">Loading AI model‚Ä¶</div>
    </div>

    <div class="chips">
      <button class="pill" data-q="C++ embedded linux RTOS">C++ Embedded</button>
      <button class="pill" data-q="Java microservices spring boot">Java Backend</button>
      <button class="pill" data-q="Python machine learning MLOps">Python ML</button>
      <button class="pill" data-q="5G telecom LTE RF">5G Telecom</button>
    </div>
  </header>

  <div id="activeFilter">üîç Active Filter: <span id="filterText">None</span></div>

  <div id="results" class="results"></div>
</div>

<script>
let model = null;
let resumeDB = [];
let resumeEmbeddings = null;

// -------------------------
// 25 Sample Resumes
// -------------------------
const seedResumes = [
  { name: "Arjun Mehta", resumeText: `Senior C++ and Embedded Engineer, 8 years experience. Skills: C++, Embedded Linux, RTOS, CAN Bus, Automotive ECUs, ARM Microcontrollers, Telecommunication Protocols, Linux Kernel modules.` },
  { name: "Sophia Rodriguez", resumeText: `Java Backend Developer, 6 years experience. Skills: Java, Spring Boot, APIs, Microservices, Docker, Cloud, Kubernetes, SQL, Kafka.` },
  { name: "Ethan Williams", resumeText: `Telecom Engineer specialized in 5G and LTE. Skills: Telecommunication, RF Systems, 5G NR, LTE, Protocol Stack, Wireless Optimization.` },
  { name: "Mira Patel", resumeText: `Embedded Firmware Engineer with IoT background. Skills: C, C++, FreeRTOS, BLE, MQTT, STM32, PCB debugging.` },
  { name: "Daniel Chen", resumeText: `Python Developer & ML Engineer. Skills: Python, TensorFlow, React, APIs, Data Engineering, MLOps, Cloud deployment.` },

  { name: "Priya Sharma", resumeText: `Data Engineer with strong ETL background. Skills: Python, PySpark, Hadoop, Hive, Airflow, AWS Glue, Redshift.` },
  { name: "Carlos Gomez", resumeText: `Full Stack Developer. Skills: JavaScript, React, Node.js, Express, MongoDB, REST APIs, CI/CD.` },
  { name: "Emily Johnson", resumeText: `Cloud DevOps Engineer. Skills: AWS, Terraform, Docker, Kubernetes, CI/CD, Linux automation.` },
  { name: "Henry Thompson", resumeText: `QA Automation Engineer. Skills: Selenium, Cypress, Java, Python, Jenkins, API testing.` },
  { name: "Ravi Kumar", resumeText: `Network Engineer. Skills: Cisco Routers, Switches, BGP, OSPF, SD-WAN, VPN, Firewalls.` },

  { name: "Laura Smith", resumeText: `UX/UI Designer. Skills: Figma, Wireframing, User Research, Accessibility, Prototyping.` },
  { name: "Ahmed Ibrahim", resumeText: `Cybersecurity Analyst. Skills: SIEM, SOC, Incident Response, Kali Linux, Firewalls.` },
  { name: "Jessica Lee", resumeText: `Machine Learning Engineer. Skills: Python, PyTorch, NLP, Computer Vision, MLOps.` },
  { name: "David Park", resumeText: `Backend Developer. Skills: Go (Golang), Microservices, GRPC, Redis, SQL.` },
  { name: "Harsh Verma", resumeText: `Automotive Controls Engineer. Skills: MATLAB, Simulink, CAN, AUTOSAR, ECU calibration.` },

  { name: "Olivia Brown", resumeText: `Mobile Developer. Skills: Flutter, Dart, Android, iOS, Firebase.` },
  { name: "Benjamin Carter", resumeText: `FPGA Engineer. Skills: Verilog, VHDL, Xilinx, Vivado, Embedded Linux.` },
  { name: "Sara Khan", resumeText: `Robotic Systems Engineer. Skills: ROS, Python, C++, SLAM, Lidar.` },
  { name: "Nathan Wilson", resumeText: `SQL Database Administrator. Skills: SQL Server, Optimization, Replication, Data Modelling.` },
  { name: "Isabella Martinez", resumeText: `Business Analyst. Skills: Requirements gathering, Jira, Confluence, BPMN.` },

  { name: "George Miller", resumeText: `Linux System Administrator. Skills: Bash, Ansible, Networking, Security Hardening.` },
  { name: "Yuki Tanaka", resumeText: `AI Research Intern. Skills: Python, Deep Learning, Transformers, Research.` },
  { name: "Michael Scott", resumeText: `Project Manager (PMP). Skills: Agile, Planning, Risk Management, Coordination.` },
  { name: "Anita Deshmukh", resumeText: `Embedded Test Engineer. Skills: HIL Testing, CANalyzer, ECU validation.` },
  { name: "Robert King", resumeText: `Java Architect. Skills: Java, Spring Cloud, Microservices, Cloud, CI/CD.` },
];

// --------------------------------------------------------------
// Helper: Generate summary
// --------------------------------------------------------------
function generateSummary(text) {
  const clean = text.replace(/\s+/g, " ").trim();
  const firstSentence = clean.split(".")[0];
  const words = clean.split(" ").slice(0, 25).join(" ");
  return (firstSentence.length < 140 ? firstSentence : words) + "...";
}

// --------------------------------------------------------------
// Highlight snippet
// --------------------------------------------------------------
function highlightSnippet(text, query) {
  let out = text.slice(0, 180) + "...";
  const terms = query.toLowerCase().split(" ").filter(t => t.length > 2);

  terms.forEach(t => {
    const re = new RegExp(`(${t})`, "ig");
    out = out.replace(re, "<mark>$1</mark>");
  });

  return out;
}

// --------------------------------------------------------------
// Keyword + semantic scoring
// --------------------------------------------------------------
function keywordBoost(query, text) {
  const q = query.toLowerCase();
  const t = text.toLowerCase();
  let hits = 0;

  const tokens = q.split(" ");

  tokens.forEach(tok => {
    if (t.includes(tok)) hits++;
  });

  return hits / tokens.length;
}

// --------------------------------------------------------------
// Model loading + embeddings
// --------------------------------------------------------------
async function initAI() {
  document.getElementById("status").innerText = "Loading AI model...";
  model = await use.load();
  document.getElementById("dot").classList.add("ok");
  document.getElementById("status").innerText = "Indexing resumes‚Ä¶";

  const texts = seedResumes.map(r => r.resumeText);
  const emb = await model.embed(texts);
  resumeEmbeddings = await emb.array();
  emb.dispose();

  document.getElementById("status").innerText = "Ready";
  document.getElementById("searchBox").disabled = false;
}

initAI();

// --------------------------------------------------------------
// Main search function
// --------------------------------------------------------------
async function searchAnd
